<!doctype html>
<html lang="en">

<head>
  <title>ChefBoost</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200..1000;1,200..1000&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
    rel="stylesheet">
  <script>
    async function sendQuery() {
      const queryInput = document.getElementById("query");
      const query = queryInput.value;
      const chatWindow = document.getElementById("chat-window");

      // Append user query to the chat window
      chatWindow.innerHTML += `<div class="user-message">${query}</div>`;
      queryInput.value = "";

      try {
        const response = await fetch("/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query })
        });

        const data = await response.json();
        if (data.error) {
          chatWindow.innerHTML += `<div class="assistant-message">Error: ${data.error}</div>`;
        } else {
          chatWindow.innerHTML += `<div class="assistant-message">${data.answer}</div>`;
          data.sources.forEach(source => {
            chatWindow.innerHTML += `<div class="source">Source: ${source.title} - ${source.snippet}</div>`;
          });
        }
      } catch (error) {
        chatWindow.innerHTML += `<div class="assistant-message">Error: ${error.message}</div>`;
      }
    }
  </script>
</head>

<body>
  <header class="site-header">
    <div class="header-content-wrapper">
      <figure>
        <a href="{{ url_for('index') }}"><img src="{{ url_for('static', filename='logo.png') }}" alt="" class="logo"></a>
        <h1 class="visually-hidden">ChefBoost</h1>
      </figure>
      <div class="user-info">
        {% if current_user.is_authenticated %}
        <div class="avatar-circle">
          <span>{{ current_user.username[0] | upper }}</span>
        </div>
        <a href="{{ url_for('my_account') }}">My Account</a>
        <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
        <a href="{{ url_for('login') }}">Login</a>
        <a href="{{ url_for('signup') }}">Sign Up</a>
        {% endif %}
      </div>
    </div>
  </header>
  <main>
    <div class="main-content-wrapper">
      <div class="chat-container">
        <section class="chatbot-header">
          <div class="chatbot-content-wrapper">
            <h2>ðŸ‘‹ ChefBoost!</h2>
          </div>
        </section>
        <section class="messages" id="chat-window">
          <!-- Messages dynamically appended here -->
        </section>
        <section class="message-input-container">
          <div class="chatbot-content-wrapper">
            <form class="message-form" onsubmit="event.preventDefault(); sendQuery();">
              <div class="input-wrapper">
                <textarea id="query" placeholder="Ask ChefBoost..." autofocus required></textarea>
                <button type="submit" id="send-btn">
                  <img src="{{ url_for('static', filename='send-icon.png') }}" alt="Send" class="send-icon">
                </button>
              </div>
            </form>
          </div>
        </section>        
      </div>
    </div>
  </main>
</body>

</html>
